<ion-header>
  <ion-toolbar color="primary">
    <ion-back-button defaultHref="/home"></ion-back-button> 
    <ion-title>5.1.1. ESTUDIO DE CAMPO (SITE SURVEY) I.E.</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content class="ion-padding orange-bg">
  <form [formGroup]="surveyForm" (ngSubmit)="submit()">
    <ion-list lines="full">
      <ion-item [class.invalid]="surveyForm.get('siteName')?.invalid && surveyForm.get('siteName')?.touched">
        <ion-label position="stacked">Nombre del sitio</ion-label>
        <ion-input formControlName="siteName" required></ion-input>
      </ion-item>
      <ion-text color="danger" *ngIf="surveyForm.get('siteName')?.invalid && surveyForm.get('siteName')?.touched">
        Este campo es obligatorio.
      </ion-text>

      <ion-item>
        <ion-label position="stacked">DirecciÃ³n</ion-label>
        <ion-input formControlName="address"></ion-input>
      </ion-item>
    </ion-list>

    <!-- TopografÃ­a -->
    <ion-card>
      <ion-card-header>
        <ion-card-title>GuÃ­a TopografÃ­a</ion-card-title>
      </ion-card-header>
      <ion-card-content>
        <img src="assets/images/guide-topography.jpg" alt="GuÃ­a TopografÃ­a" />
      </ion-card-content>
    </ion-card>
    <ion-item>
      <ion-label position="stacked">Condiciones TopogrÃ¡ficas</ion-label>
      <ion-textarea formControlName="topographicConditions"></ion-textarea>
    </ion-item>
    <ion-item>
      <ion-label>Foto TopografÃ­a</ion-label>
      <ion-button fill="outline" (click)="takePhoto('topographyPhoto')">
        ðŸ“· Capturar
      </ion-button>
    </ion-item>
    <ion-img *ngIf="surveyForm.value.topographyPhoto" [src]="surveyForm.value.topographyPhoto" class="photo-preview"></ion-img>

    <!-- Infraestructura -->
    <ion-card>
      <ion-card-header>
        <ion-card-title>GuÃ­a Infraestructura</ion-card-title>
      </ion-card-header>
      <ion-card-content>
        <img src="assets/images/guide-infrastructure.jpg" alt="GuÃ­a Infraestructura" />
      </ion-card-content>
    </ion-card>
    <ion-item>
      <ion-label position="stacked">Infraestructura existente</ion-label>
      <ion-textarea formControlName="infrastructure"></ion-textarea>
    </ion-item>
    <ion-item>
      <ion-label>Foto Infraestructura</ion-label>
      <ion-button fill="outline" (click)="takePhoto('infrastructurePhoto')">
        ðŸ“· Capturar
      </ion-button>
    </ion-item>
    <ion-img *ngIf="surveyForm.value.infrastructurePhoto" [src]="surveyForm.value.infrastructurePhoto" class="photo-preview"></ion-img>

    <!-- RF Survey -->
    <ion-card>
      <ion-card-header>
        <ion-card-title>GuÃ­a RF Survey</ion-card-title>
      </ion-card-header>
      <ion-card-content>
        <img src="assets/images/guide-rf-survey.jpg" alt="GuÃ­a RF Survey" />
      </ion-card-content>
    </ion-card>
    <ion-item>
      <ion-label position="stacked">Ruido electromagnÃ©tico (dBm)</ion-label>
      <ion-input type="number" formControlName="rfNoise"></ion-input>
    </ion-item>
    <ion-item>
      <ion-label position="stacked">SNR (dB)</ion-label>
      <ion-input type="number" formControlName="rfSnr"></ion-input>
    </ion-item>
    <ion-item>
      <ion-label>Foto RF Survey</ion-label>
      <ion-button fill="outline" (click)="takePhoto('rfSurveyPhoto')">
        ðŸ“· Capturar
      </ion-button>
    </ion-item>
    <ion-img *ngIf="surveyForm.value.rfSurveyPhoto" [src]="surveyForm.value.rfSurveyPhoto" class="photo-preview"></ion-img>

    <!-- Cableado / Ãšltima milla -->
    <ion-item>
      <ion-label position="stacked">Cableado / Ãšltima milla</ion-label>
      <ion-textarea formControlName="cableLastMile"></ion-textarea>
    </ion-item>
    <ion-item>
      <ion-label>Foto Cableado</ion-label>
      <ion-button fill="outline" (click)="takePhoto('cablePhoto')">
        ðŸ“· Capturar
      </ion-button>
    </ion-item>
    <ion-img *ngIf="surveyForm.value.cablePhoto" [src]="surveyForm.value.cablePhoto" class="photo-preview"></ion-img>

    <!-- Headend -->
    <ion-item>
      <ion-label position="stacked">UbicaciÃ³n Headend</ion-label>
      <ion-input formControlName="headendLocation"></ion-input>
    </ion-item>
    <ion-item>
      <ion-label>Foto Headend</ion-label>
      <ion-button fill="outline" (click)="takePhoto('headendPhoto')">
        ðŸ“· Capturar
      </ion-button>
    </ion-item>
    <ion-img *ngIf="surveyForm.value.headendPhoto" [src]="surveyForm.value.headendPhoto" class="photo-preview"></ion-img>

    <!-- Hogares a conectar -->
    <ion-item>
      <ion-label position="stacked">UbicaciÃ³n Hogares a conectar</ion-label>
      <ion-input formControlName="homesLocation"></ion-input>
    </ion-item>
    <ion-item>
      <ion-label>Foto Hogares</ion-label>
      <ion-button fill="outline" (click)="takePhoto('homesPhoto')">
        ðŸ“· Capturar
      </ion-button>
    </ion-item>
    <ion-img *ngIf="surveyForm.value.homesPhoto" [src]="surveyForm.value.homesPhoto" class="photo-preview"></ion-img>

    <!-- Firma digital -->
    <ion-item lines="none">
      <ion-label>Firma del Cliente</ion-label>
    </ion-item>
    <canvas #signatureCanvas class="signature-pad"></canvas>
    <ion-button fill="clear" (click)="clearSignature()">Limpiar Firma</ion-button>
    <ion-button expand="block" (click)="saveSignature()">Guardar Firma</ion-button>
    <ion-img *ngIf="signatureData" [src]="signatureData" class="photo-preview"></ion-img>

    <ion-button
      type="submit"
      expand="block"
      color="primary"
      class="submit-btn">
      Enviar Survey
    </ion-button>
  </form>
</ion-content>
